@startuml

package "UI Component" {
    class MotorControlUI {
        - _ecu_connector: ECUConnector
        + __init__(parent: QWidget)
    }

    class SliderWithLabels {
        - _value: int
        - _signal: pyqtSignal
        + value_changed: pyqtSignal
        + __init__(parent: QWidget)
        + get_value() -> int
        + set_value(value: int)
    }

    class TickLabelsWidget {
        + __init__(parent: QWidget)
        + paint_event(event: QPaintEvent)
    }
}

package "ECU Connector Component" {
    class ECUConnector {
        - _transport: ITransport
        - _command_queue: CommandQueue
        - _current_state: ConnectionState
        - _worker_thread: Thread
        - _running: bool
        - _total_commands: int
        - _failed_commands: int
        + __init__(transport: ITransport)
        + connect(host: str, port: int) -> bool
        + disconnect() -> None
        + get_api_version() -> int
        + set_motor_speed(motor_id: int, speed: int) -> bool
        + set_all_motors_speed(speeds: List[int]) -> bool
        + is_connected() -> bool
        + get_command_stats() -> Tuple[int, int]
        + reset_command_stats() -> None
        - _process_queue() -> None
        - _worker_loop() -> None
        + start() -> None
        + stop() -> None
    }

    class CommandQueue {
        - _queue: Queue[Command]
        + push(command: Command) -> None
        + pop() -> Optional[Command]
        + is_empty() -> bool
    }

    abstract class Command {
        + timeout: float
        + __init__(timeout: float = 1.0)
        @abstractmethod
        + execute() -> Response
    }

    class SetMotorSpeedCommand extends Command {
        - motorId: int
        - speed: int
        + execute()
    }

    class SetAllMotorsSpeedCommand extends Command {
        - speeds: List[int]
        + execute()
    }

    class GetApiVersionCommand extends Command {
        + execute(): int
    }

    interface ITransport {
        + connect(host: str, port: int): bool
        + disconnect()
        + send(data: bytes): bool
        + receive(size: int): bytes
    }

    class TCPTransport implements ITransport {
        - socket: Socket
    }
}

MotorControlUI --> ECUConnector
ECUConnector --> ITransport
ECUConnector --> CommandQueue
CommandQueue --> Command
ECUConnector ..> Command: creates

@enduml
